#!/usr/bin/env bash
set -Euo pipefail
SCRIPT_DIR=$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)
. "$SCRIPT_DIR/agentd-common"

usage(){ echo "usage: job-logs <token> [-f]"; }

if [[ $# -lt 1 ]]; then usage; exit 2; fi

token=$1; shift || true
follow=${1:-}
log_file="$AGENTD_LOGDIR/$token.log"

if [[ ! -f "$log_file" ]]; then
  echo "no log yet: $log_file" >&2
fi

if [[ "$follow" == "-f" ]]; then
  # Show existing and follow new
  { test -f "$log_file" && tail -n +1 -f "$log_file" || tail -f "$log_file"; }
else
  test -f "$log_file" && cat "$log_file" || true
fi

